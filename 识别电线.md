# 深度学习识别电线实现说明

## 安装TensorFlow
TensorFlow的下载以及安装的步骤可以参考[`ＧitHub`](https://github.com/tensorflow/tensorflow)。
或者可以参考极客学院提供的中文版文档，[传送门](http://wiki.jikexueyuan.com/project/tensorflow-zh/get_started/os_setup.html)。
这里只给出Ｕｂｕｎｔｕ Ｐｉｐ安装的教程。其他操作系统和安装方法可通过上面的链接获得。

### Pip 安装
Pip 是一个 Python 的软件包安装与管理工具。首先安装Ｐｉｐ（或者Ｐｙｔｈｏｎ３的ｐｉｐ３）：
```shell
$ sudo apt-get install python-pip python-dev
```
安装ＴｅｎｓｏｒＦｌｏｗ：
```shell
# Ubuntu/Linux 64-bit, CPU only, Python 2.7:
$ sudo pip install --upgrade https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-1.2.0-cp27-none-linux_x86_64.whl

# Ubuntu/Linux 64-bit, GPU enabled, Python 2.7. Requires CUDA toolkit 7.5 and CuDNN v4.
# For other versions, see "Install from sources" below.
$ sudo pip install --upgrade https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow-1.2.0-cp27-none-linux_x86_64.whl
```

安装完后，可以运行一个简单的Ｐｙｔｈｏｎ代码测试。
```shell
$ python
```
```python
>>> import tensorflow as tf
>>> hello = tf.constant('Hello, TensorFlow!')
>>> sess = tf.Session()
>>> sess.run(hello)
'Hello, TensorFlow!'
>>> a = tf.constant(10)
>>> b = tf.constant(32)
>>> sess.run(a + b)
42
>>> sess.close()
```

## 运行ＴｅｎｓｏｒＦｌｏｗ
首先，需要把ＴｅｎｓｏｒＦｌｏｗ的Ｒｅｐｏ克隆到本地。
```shell
$ git checkout https://github.com/tensorflow/tensorflow.git
```
[`makefile`](https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/makefile)目录下提供了
如何在各个平台上编译ＴｅｎｓｏｒＦｌｏｗ的详细说明以及脚本文件。编译成功后会生成一个`benchmark`用于检测整个系统是否搭建成功。
由于测试的系统是Ｕｂｕｎｔｕ的，这里还是给出Ｕｂｕｎｔｕ下的编译说明。不管是哪个平台上，编译前需要下载一些依赖项。这个脚本只需要运行一次，下载完成即可。
（**所有命令需要在根目录下运行**）
```shell
$ tensorflow/contrib/makefile/download_dependencies.sh
```
相关的库文件会保存在`tensorflow/contrib/makefile/downloads/`文件夹内。另外，需要下载一个测试用的graph: 
[inception](https://storage.googleapis.com/download.tensorflow.org/models/inception5h.zip)

在Ｕｂｕｎｔｕ上编译前需确保相关的软件包已经安装好，可先运行：
```shell
$ sudo apt-get install autoconf automake libtool curl make g++ unzip zlib1g-dev \
git python
```
然后运行`build_all_linux.sh`脚本：
```shell
$ tensorflow/contrib/makefile/build_all_linux.sh
```
编译完成后，会生成可执行文件`tensorflow/contrib/makefile/gen/bin/benchmark`。下载ｇｒａｐｈ后，需解压缩：
```shell
$ mkdir -p ~/graphs
$ curl -o ~/graphs/inception.zip \
 https://storage.googleapis.com/download.tensorflow.org/models/inception5h.zip \
 && unzip ~/graphs/inception.zip -d ~/graphs/inception
```
运行`benchmark`：
```shell
$ tensorflow/contrib/makefile/gen/bin/benchmark \
 --graph=$HOME/graphs/inception/tensorflow_inception_graph.pb
```

## 在Ａｎｄｒｏｉｄ上运行label_image
本项目的平台是Ｖ２上的Ａｎｄｒｏｉｄ，识别电线使用的是深度学习图片分类的功能。
ＴｅｎｓｏｒＦｌｏｗ的Ｇｉｔｈｕｂ上已经提供了在Ｒａｓｐｂｅｒｒｙ上运行图片分类的Ｃ＋＋代码ｌａｂｅｌｅｄ_image，在`tensorflow/contrib/pi_examples`目录下可找到详细说明。
而在Ａｎｄｒｏｉｄ上运行需要对应把一些文件换成Ａｎｄｒｏｉｄ版的。编译ｌａｂｅｌ_image之前需要得到一个ＴｅｎｓｏｒＦｌｏｗ的静态库。
上面运行`build_all_linux.sh`的时候已经生成了一个Ｌｉｎｕｘ下的库，Ａｎｄｒｏｉｄ下的需要对应的运行`build_all_android.sh`。
载入图片需要的ｌｉｂｊｐｅｇ.so，在Ａｎｄｒｏｉｄ上也需要单独下载安装(忘了链接，需要的话可以找我拷)。Ｕｂｕｎｔｕ下可直接运行：
```shell
$ sudo apt-get install -y libjpeg-dev
```
为了生成可以在Ａｎｄｒｏｉｄ上运行的ｌａｂｅｌ_image，这里的ｍａｋｅｆｉｌｅ参考了生成Ａｎｄｒｏｉｄ benchmark的ｍａｋｅｆｉｌｅ。＠祖国将整理后的文件上传到了Ｇｉｔｈｕｂ，
[链接](https://github.com/yuzuguo/tensorflow/tree/master/tensorflow/contrib/pi_examples/input_image)。可直接克隆＠祖国的Ｒｅｐｏ运行,
或者根据他的文件进行修改。主要注意ｍａｋｅｆｉｌｅ以及编译时的参数，如`arm64-v8a`。运行前Ａｎｄｒｏｉｄ版需要Ｖ２上对应的ＮＤＫ（未上传），并设置本地的路径：
```shell
$ export NDK_ROOT=/absolute/path/to/NDK/android-ndk-rxxx/
```


## 获取ＭｏｂｉｌｅＮｅｔ模型
编译好可执行图像分类代码后，最重要的找到一个合适的深度学习模型。
[tensorflow/models](https://github.com/tensorflow/models)这里主要是提供各种基于ＴｅｎｓｏｒＦｌｏｗ实现的深度学习模型。
这次识别电线用到的ＭｏｂｉｌｅＮｅｔ也是从这里获取的。ＭｏｂｉｌｅＮｅｔ是Ｇｏｏｇｌｅ提出的一个针对移动端的轻量级深度学习模型。
除了现成的模型，这里还包含了整个基于ＴｅｎｓｏｒＦｌｏｗ的深度学习训练工具以及说明文档。之后项目的训练也会基于这些工具进行。
建议将这个Ｒｅｐｏ克隆到本地。

```shell
$ git checkout https://github.com/tensorflow/models.git
```

### ＭｏｂｉｌｅＮｅｔ_v1
